<html>
<head>
  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" media="screen" href="//netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
</head>
<body>
  
  <div class="container text-center" style="margin-top: 3em;">
    <label>Unique Driver ID: <input type="text" class="form-control" id="us3-id" style="width: 200px" value=""/> </label> 
    <!-- Radius: <input type="text" id="us3-radius"/> -->
    
    <div class="row">
      <label>Drag around the Marker in below map to mark your Current Position:</label>
      <div id="us3" class="form-control" style="width: 100%; height: 450px;"></div>
    </div>
    
    <label>Lat.: <input type="text" class="form-control" id="us3-lat"/></label>
    <label> Long.: <input type="text" class="form-control" id="us3-lon"/> </label>    
  </div>
  
  
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>    
  <script type="text/javascript" src='http://maps.google.com/maps/api/js? sensor=false&libraries=places&key=AIzaSyBfXwliPdMdFFkPNRGQByETe4sn-x06X_4'></script>
  <script src="https://cdn.rawgit.com/Logicify/jquery-locationpicker-plugin/fac86581/dist/locationpicker.jquery.min.js"></script>
  <script type="text/javascript" src="http://localhost:3000/faye/client.js">
  </script>
  <script>
    var faye = new Faye.Client('http://localhost:3000/faye');

    $("#us3-id").val(Date.now());

    // send heartbeats (keep alive) every minute
    setInterval(function () {
      faye.publish("/heartbeat/" + $('#us3-id').val(), { timestamp: Date.now() })
    }, 60 * 1000)

    $('#us3').locationpicker({
      location: {
        latitude: 22.5726,
        longitude: 88.3639
      },
      radius: 0,
      inputBinding: {
        latitudeInput: $('#us3-lat'),
        longitudeInput: $('#us3-lon'),
        // radiusInput: $('#us3-radius'),
        // locationNameInput: $('#us3-address')
      },
      enableAutocomplete: true,
      onchanged: function (currentLocation, radius, isMarkerDropped) {
        if (isMarkerDropped) {
          console.log("marker Drooped....");
          faye.publish('/location/' + $('#us3-id').val(), { lng: $('#us3-lon').val(), lat: $('#us3-lat').val()  });
        }
        // $.ajax({
        //   method: "POST",
        //   url: "http://localhost:3000/location",
        //   data: {
        //     lng: $('#us3-lon').val(),
        //     lat: $('#us3-lat').val(),
        //     id: $('#us3-id').val(),
        //   }
        // })
      }
    });

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(geoPos) {
          $('#us3-lon').val(geoPos.coords.longitude)
          $('#us3-lat').val(geoPos.coords.latitude)
        });
    }
    </script>
  </body>
  </html>